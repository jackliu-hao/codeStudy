å…·ä½“ä»£ç å›å¤å…¬ä¼—å·: nginxWebä»£ç å®¡è®¡

# ä¸€ã€å‰æœŸå‡†å¤‡

## 1.1 jaråŒ…åç¼–è¯‘

â€‹	æœ‰æ—¶å€™æˆ‘ä»¬ä¼šé‡åˆ°åªæœ‰jarçš„æƒ…å†µï¼Œä½†æ˜¯å¦‚ä½•ç›´æ¥è§£å‹jaråŒ…ä¼šå‘ç°éƒ½æ˜¯æ–‡ä»¶éƒ½æ˜¯.class,é‡Œé¢çš„å˜é‡éƒ½æ˜¯var1 ï¼Œvar 2ç­‰ç­‰ï¼Œè€Œä¸”è¿˜æ²¡åŠæ³•è°ƒè¯•ã€‚å› æ­¤ï¼Œå¦‚æœæ‹¿åˆ°jaråŒ…åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œåç¼–è¯‘ï¼Œè¿™é‡Œä½¿ç”¨ä¸¤ç§æ–¹å¼ã€‚

### ä½¿ç”¨ **jd-gui**

![image-20240201155339559](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240201155339559.png)

æ‰“å¼€æ–‡ä»¶åï¼Œåœ¨ä¿å­˜all soureåˆ°æŒ‡å®šä½ç½®ã€‚

![image-20240201155436799](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240201155436799.png)

## ä½¿ç”¨ideaè‡ªå¸¦åç¼–è¯‘å·¥å…·

### 1ã€Ideaå®‰è£…decompileræ’ä»¶

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/94ea575844484ef8a3b32a2d813081b5.png)

å¦‚æœæœä¸åˆ°é‚£å°±æ˜¯ideaå†…ç½®äº†åç¼–è¯‘æ’ä»¶ï¼Œæ‰¾åˆ°ideaçš„å®‰è£…ç›®å½•ä¸‹çš„\plugins\java-decompiler\lib ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªjarå°±æ˜¯ç”¨äºåç¼–è¯‘çš„ã€‚

### 2ã€åç¼–è¯‘jaråŒ…

(1) åœ¨ä½ æƒ³è¦åç¼–è¯‘çš„jaræ–‡ä»¶å¤¹ä¸‹ç›´æ¥cmdæ‰§è¡Œä»¥ä¸‹å‘½ä»¤

```she
java -cp "E:\soft\idea2022\installed\IntelliJ IDEA 2022.2\plugins\java-decompiler\lib\java-decompiler.jar" org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=true G:\git\codeReviewLog\nginxWebUi\nginxWebUI-3.4.6.jar G:\git\codeReviewLog\nginxWebUi\myjarByIdea

è¯´æ˜ï¼š
åŒå¼•å·é‡Œé¢æ˜¯ä½  Java Bytecode Decomplier æ’ä»¶çš„ç›®å½•ï¼Œå°±æ˜¯ç¬¬ä¸€æ­¥æˆ‘è®©ä½ ä»¬æ‰¾çš„è·¯å¾„ã€‚
org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler ï¼šæ˜¯å›ºå®šçš„ä¸å˜å°±å¥½ï¼Œæ˜¯å¯åŠ¨ç±»ã€‚
nginxWebUI-3.4.6.jar ï¼šæ˜¯æˆ‘è¦åç¼–è¯‘çš„jaråŒ…åç§°ã€‚
myjarByIdeaï¼šæ˜¯æˆ‘åç¼–è¯‘å®Œï¼Œæ–°ç”Ÿæˆjaræ”¾çš„ä½ç½®ã€‚

```

(2) åç¼–è¯‘å®Œæˆåœ¨ä½ æŒ‡å®šæ–‡ä»¶å¤¹ç”Ÿæˆæ–°çš„jar
(3) æŸ¥çœ‹è§£å‹æ–‡ä»¶

`ä¸åŒç‰ˆæœ¬çš„ideaæ”¯æŒçš„Javaç‰ˆæœ¬ä¸åŒ`



## 1.2 è¿œç¨‹è°ƒè¯•

â€‹	é€šè¿‡åç¼–è¯‘çš„æºä»£ç ï¼Œæ˜¯è¿è¡Œä¸äº†çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨è¿œç¨‹è°ƒè¯•è¿›è¡Œè°ƒè¯•ä»£ç ã€‚è¿œç¨‹è°ƒè¯•ä½¿ç”¨çš„agentæŠ€æœ¯ï¼Œå…·ä½“ç»†èŠ‚å¯ä»¥è‡ªè¡Œæœç´¢ã€‚

â€‹	æˆ‘ä»¬åœ¨è¿™é‡Œå¼€å§‹è¿œç¨‹JVMè°ƒè¯•ï¼Œä¸€èˆ¬æˆ‘ä»¬java webè¿œç¨‹debugçš„è¯  åªè¦è®¾ç½®å¥½ä¸‰è¦ç´ 

- 1.ä¸»æœº
- 2.ç«¯å£
- 3.JDKç‰ˆæœ¬

é…ç½®é¡¹ç›®ï¼Œæ·»åŠ è¿œç¨‹è°ƒè¯•ï¼Œå¤åˆ¶ç»™å‡ºçš„å‘½ä»¤è¡Œå®å‚

-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8080

![image-20240201161530599](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240201161530599.png)

æ³¨æ„ä¸è¦å¸¦*

```
æ·»åŠ åˆ°å¯åŠ¨jaråŒ…çš„cmdå‘½ä»¤:
java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005  -jar -Dfile.encoding=UTF-8  nginxWebUI-3.4.6.jar   --server.port=8080 --project.home=D:/home/nginxWebUI/

```













# äºŒã€ä»£ç å®¡è®¡

## 2.1 æƒé™ç»•è¿‡

â€‹	æŒ‰ç…§ç®¡ç†ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æƒé™æ–¹é¢æœ‰æ²¡æœ‰é—®é¢˜ï¼Œè¿™é‡Œæƒé™æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ï¼Œé‚£åº”è¯¥å°±æ˜¯è‡ªå·±å†™çš„filterã€‚

```java

public void doFilter(Context ctx, FilterChain chain) throws Throwable {
 
    ....

   // ç™»å½•è¿‡æ»¤å™¨
   if (ctx.path().contains("/adminPage/") //
         && !ctx.path().contains("/lib/") //
         && !ctx.path().contains("/doc/") //
         && !ctx.path().contains("/js/") //
         && !ctx.path().contains("/img/") //
         && !ctx.path().contains("/css/")) {
      if (!adminInterceptor(ctx)) {
         // è®¾ç½®ä¸ºå·²å¤„ç†
         ctx.setHandled(true);
         return;
      }
   }
 
....
   chain.doFilter(ctx);

}
```

æˆ‘ä»¬å°±æ‹¿å…¶ä¸­ä¸€ä¸ªä¸¾ä¾‹å­ï¼Œå¦‚æœè¯´iféƒ½æ²¡æœ‰è¿›å»ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œæœ€åçš„   chain.doFilter(ctx) ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬åº”è¯¥æ€ä¹ˆç»•è¿‡å‘¢ï¼Ÿ

æˆ‘ä»¬çŸ¥é“åœ¨Javaä¸­String.contains()æ˜¯åŒºåˆ«å¤§å°å†™çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½ç¡®å®šå¦‚æœä¸­é—´ä»¶åœ¨å¤„ç†è¯·æ±‚çš„æ—¶å€™æ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹ã€‚![image-20240202110057919](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202110057919.png)



å¯ä»¥çœ‹åˆ°åœ¨Linuxä¸‹ï¼Œåœ¨ä¸­é—´ä»¶ä¸­å¤„ç†URLä¹Ÿæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚é‚£æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ç»•è¿‡äº†ã€‚

![image-20240202110200487](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202110200487.png)



## 2.2 **éªŒè¯ç å¤ç”¨**

```java
// è¿™ä¸ªéªŒè¯ç æœ‰ä¸¤ä¸ªé—®é¢˜
//1ã€å¦‚æœ remote !=  null ä¼šç»•è¿‡éªŒè¯ç 
//2ã€å¦‚æœç¬¬ä¸€æ¬¡éªŒè¯ç æ­£ç¡®ï¼Œè´¦å¯†ä¸å¯¹ï¼Œé‚£Context.current().sessionRemove("captcha"); 
// è¿™å¥å°±æ‰§è¡Œä¸åˆ°,å› æ­¤ä¸ä¼šé”€æ¯sessionä¸­çš„éªŒè¯ç ï¼Œä½†æ˜¯å‰ç«¯æœ‰æ²¡æœ‰åˆ·æ–°éªŒè¯ç ï¼Œè¿™æ ·å°±å¯¼è‡´éªŒè¯ç å¤ç”¨çš„é—®é¢˜ã€‚

if (remote == null) {
   String captcha = (String) Context.current().session("captcha");
   if (!code.equals(captcha)) {
      Context.current().sessionRemove("captcha"); // é”€æ¯éªŒè¯ç 
      return renderError(m.get("loginStr.backError1")); // éªŒè¯ç ä¸æ­£ç¡®
   }
}
```

## 2.3 å‘½ä»¤æ‰§è¡Œ



![image-20240202113643434](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202113643434.png)

![image-20240202114042290](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202114042290.png)



## 2.4 æ›´æ–°æ—¶æœªæ ¡éªŒjaråŒ…

è¿™æ˜¯æ›´æ–°æ—¶å€™çš„æ•°æ®åŒ…ï¼Œå¯ä»¥çœ‹åˆ°urlæ˜¯å¯æ§çš„

![image-20240202144002332](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202144002332.png)



â€‹	åå°å¤„ç†çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠŠjarä¸‹è½½å‘½åä¸ºæŒ‡å®šjaråŒ…ï¼Œå¦‚æœæˆ‘ä»¬å°†æ¶æ„jaråŒ…æ”¾åˆ°æœåŠ¡å™¨ï¼Œå°†urlæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„jarï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯å®ç°äº†ä»£ç ä¼šæ›´æ–°æˆæˆ‘ä»¬çš„æ¶æ„jaråŒ…ã€‚ä½†æ˜¯è¿™æ ·å¦‚æœåœ¨å®é™…æ¸—é€ä¸­ï¼Œè¿˜æ˜¯æ…ç”¨ï¼Œå› ä¸ºä¸šåŠ¡ä¼šåœæ‰ã€‚ğŸ™„

![image-20240202144054319](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202144054319.png)

1ã€é¦–å…ˆï¼Œä½¿ç”¨bootå†™ä¸€ä¸ªç®€å•çš„controllerï¼Œè®©ä»–æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”å°†ç»“æœä»¥å­—ç¬¦ä¸²æ–¹å¼è¿”å›åˆ°responseæ•°æ®æµä¸­ã€‚(è¿™ä¸ªbooté¡¹ç›®åœ¨å¯åŠ¨ç±»ä¸­ï¼Œéœ€è¦ç•¥å¾®ä¿®æ”¹)

![image-20240202144414514](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202144414514.png)

2ã€ç”¨pythonçš„httpæ¨¡å—ï¼Œå¼€å¯ç›‘å¬ã€‚

![image-20240202144517894](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202144517894.png)

3ã€ä¿®æ”¹æ•°æ®åŒ…ä¸­çš„æŒ‡å®šurlï¼Œåç­‰å¯åŠ¨æˆ‘ä»¬çš„æ¶æ„jaråŒ…ã€‚

![image-20240202144707307](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202144707307.png)

å·²ç»å°†æ–‡ä»¶ä¸‹è½½åˆ°äº†æœ¬åœ°

![image-20240202144754422](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202144754422.png)

æ›´æ–°å®Œæˆåï¼Œæ­¤æ—¶è¿è¡Œçš„jaråŒ…ï¼Œå°±æ˜¯æˆ‘ä»¬æ„é€ çš„jaråŒ…äº†ã€‚

## 2.5 ä»»æ„æ–‡ä»¶ä¸Šä¼ 

â€‹	åœ¨åŠŸèƒ½é™æ€ç½‘é¡µä¸Šä¼ çš„åœ°æ–¹ï¼Œåªåœ¨å‰ç«¯å¯¹æ–‡ä»¶æ ¼å¼è¿›è¡Œäº†æ ¡éªŒï¼Œåœ¨åç«¯å¹¶æ²¡æœ‰æ ¡éªŒæ–‡ä»¶æ ¼å¼ï¼Œä½†æ˜¯è¿™ä¸ªæ¡†æ¶è²Œä¼¼å¹¶ä¸ä¼šè§£æjspæ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡../ çš„æ–¹å¼è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œä»è€Œæ›¿æ¢ç³»ç»Ÿé‡è¦çš„æ–‡ä»¶ã€‚

![image-20240202203848996](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202203848996.png)

![image-20240202204436917](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202204436917.png)

å¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»è¿›è¡Œäº†ç›®å½•ç©¿è¶Š



![image-20240202204418929](%E5%AE%A1%E8%AE%A1%E8%AE%B0%E5%BD%95.assets/image-20240202204418929.png)



`æ­¤æ¼æ´å¯ä»¥é…åˆç³»ç»Ÿä¸­çš„ æ–‡ä»¶åˆ—å‡ºåŠŸèƒ½ï¼ŒæŸ¥çœ‹ç³»ç»Ÿçš„é‡è¦æ–‡ä»¶ï¼Œæ¯”å¦‚/etc/passwd æ–‡ä»¶ï¼Œä»è€Œå®ç°sshç™»å½•ï¼Œç›¸å¯¹æ¥è¯´å±å®³è¿˜æ˜¯æŒºé«˜çš„`







